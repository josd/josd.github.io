<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>n-Queens — ARC style (self‑contained)</title>
  <style>
    :root{
      --bg:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --panel:#f8fafc;
      --border:#e5e7eb;
      --accent:#0ea5e9;
      --good:#16a34a;
      --warn:#dc2626;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --ui: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }
    html,body{height:100%}
    body{ margin:0; background:var(--bg); color:var(--ink); font:15px/1.5 var(--ui); }
    .wrap{max-width:980px; margin:36px auto; padding:0 16px;}
    header{display:flex; align-items:center; justify-content:space-between; margin-bottom:16px}
    h1{font-size:22px; margin:0; letter-spacing:.2px}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid var(--border); border-radius:999px; color:var(--muted); background:#fff}
    .row{display:flex; flex-direction:column; gap:16px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:14px; overflow:hidden}
    .head{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid var(--border)}
    .head h2{font-size:13px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted); margin:0}
    .body{padding:12px}
    input[type="number"]{width:100px; padding:8px; border:1px solid var(--border); border-radius:10px; font:14px var(--ui)}
    pre{white-space:pre-wrap; background:#fff; border:1px solid var(--border); border-radius:10px; padding:12px; overflow:auto; font-family:var(--mono); font-size:13px}
    .bar{display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; align-items:center}
    button{all:unset; background:#fff; border:1px solid var(--border); padding:8px 12px; border-radius:10px; cursor:pointer}
    button:hover{border-color:#cbd5e1}
    .small{color:var(--muted); text-decoration:none}
    .ok{color:var(--good)}
    .accent{color:var(--accent)}
    .warn{color:var(--warn)}
    .hr{height:1px; background:var(--border); margin:10px 0}
    .k{font-weight:600}
    .kv{color:#0f172a}
    /* ARC Cards */
    .arc-grid{display:flex; flex-direction:column; gap:12px}
    .arc-card{background:#fff; border:1px solid var(--border); border-radius:14px; overflow:hidden}
    .arc-card .ac-head{display:flex; align-items:center; gap:8px; padding:10px 12px; border-bottom:1px solid var(--border); font-size:12px; letter-spacing:.08em; text-transform:uppercase; color:var(--muted)}
    .arc-card .ac-body{padding:12px}
    .arc-card pre{margin:0; white-space:pre-wrap; background:#fff; border:1px solid #eef2f7; border-radius:10px; padding:10px; font-family:var(--mono); font-size:13px}
    .arc-card.answer{border-left:4px solid #10b981}
    .arc-card.reason{border-left:4px solid #3b82f6}
    .arc-card.check{border-left:4px solid #f59e0b}
    .toolbar{display:flex; gap:8px; align-items:center}
    /* Chessboard */
    .board-wrap{display:flex; flex-direction:column; gap:8px; align-items:flex-start}
    .board{--n:8; width:min(92vw, 560px); border:1px solid var(--border); border-radius:14px; overflow:hidden; background:#cbd5e1}
    .grid{display:grid; grid-template-columns:repeat(var(--n), 1fr); gap:1px}
    .sq{aspect-ratio:1/1; display:flex; align-items:center; justify-content:center; font-size:calc(12px + 1.4vw);}
    .light{background:#f8fafc; color:#111827}
    .dark{background:#94a3b8; color:#0b1220}
    .queen{font-size:calc(16px + 1.6vw); line-height:1}
    .meta{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>n-Queens — <span class="accent">ARC</span> (Answer • Reason • Check)</h1>
      <div class="pill" id="statusPill">Ready</div>
    </header>

    <div class="card" style="margin-bottom:16px">
      <div class="body">
        <p><strong>What this is?</strong> A self‑contained, browser‑only harness for the classical <em>n‑Queens</em> problem.
        Set <code>N</code>, click <em>Run</em>, and view an ARC report (<em>Answer • Reason • Check</em>) plus a visual board with chess queens.</p>
        <p class="small">This page is for reproducibility and documentation only.</p>
      </div>
    </div>

    <div class="row">
      <div class="card">
        <div class="head"><h2>Input</h2></div>
        <div class="body">
          <div class="bar">
            <label for="nInput" class="small">N (board size):</label>
            <input id="nInput" type="number" min="1" max="16" step="1" value="8" />
            <button onclick="run()">▶ Run</button>
            <button onclick="prevSol()">◀ Prev</button>
            <button onclick="nextSol()">Next ▶</button>
            <span class="small" id="solBadge">—</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="head"><h2>Case — Size & Goal</h2></div>
        <div class="body">
          <pre id="casebox">Board size : N = 8
Goal       : Place N queens so none attack each other</pre>
        </div>
      </div>

      <div class="card">
        <div class="head"><h2>Board</h2></div>
        <div class="body">
          <div class="board-wrap">
            <div id="board" class="board">
              <div id="grid" class="grid"></div>
            </div>
            <div class="meta" id="boardMeta">(no solution shown)</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <h2>ARC Output</h2>
          <div class="toolbar">
            <button onclick="toggleArcStyle()" id="styleBtn">Style: Cards</button>
            <button onclick="downloadARC()">⬇ Export .txt</button>
            <a class="small" href="#" onclick="copyOutput();return false;">Copy</a>
          </div>
        </div>
        <div class="body">
          <div id="arc-cards" class="arc-grid">
            <div class="arc-card answer">
              <div class="ac-head">Answer</div>
              <div class="ac-body"><pre id="arc_ans">(no run yet)</pre></div>
            </div>
            <div class="arc-card reason">
              <div class="ac-head">Reason why</div>
              <div class="ac-body"><pre id="arc_reason">(no run yet)</pre></div>
            </div>
            <div class="arc-card check">
              <div class="ac-head">Check (harness)</div>
              <div class="ac-body"><pre id="arc_check">(no run yet)</pre></div>
            </div>
          </div>
          <pre id="arc" style="display:none">(no run yet)</pre>
        </div>
      </div>
    </div>
  </div>

<script>
// ---------- Known reference counts (for Check section) ----------
const KNOWN = {1:1, 2:0, 3:0, 4:2, 5:10, 6:4, 7:40, 8:92, 9:352, 10:724, 11:2680, 12:14200, 13:73712, 14:365596};

// ---------- N-Queens solver (backtracking) ----------
function solveNQueens(N, maxSolutions=100000){
  const cols = new Set();
  const d1 = new Set(); // r - c
  const d2 = new Set(); // r + c
  const cur = new Array(N);
  const res = [];
  let nodes = 0;
  function backtrack(c){
    nodes++;
    if(c===N){ res.push(cur.slice()); return; }
    for(let r=0;r<N;r++){
      const a = r, b = r-c, csum = r+c;
      if(cols.has(a) || d1.has(b) || d2.has(csum)) continue;
      cols.add(a); d1.add(b); d2.add(csum); cur[c]=r;
      backtrack(c+1);
      cols.delete(a); d1.delete(b); d2.delete(csum);
      if(res.length>=maxSolutions) return;
    }
  }
  backtrack(0);
  return {solutions:res, nodes};
}

// ---------- Board rendering ----------
function renderBoard(N, solution){
  const grid = document.getElementById('grid');
  const board = document.getElementById('board');
  board.style.setProperty('--n', N);
  grid.style.gridTemplateColumns = `repeat(${N}, 1fr)`;
  grid.innerHTML = '';
  for(let r=0;r<N;r++){
    for(let c=0;c<N;c++){
      const isDark = (r+c)%2===1;
      const cell = document.createElement('div');
      cell.className = 'sq ' + (isDark ? 'dark' : 'light');
      if(solution && solution[c]===r){
        const q = document.createElement('span');
        q.className = 'queen';
        q.textContent = '♛';
        cell.appendChild(q);
      }
      grid.appendChild(cell);
    }
  }
}

// ---------- ARC generation ----------
function toCoords(sol){ // 1-based (col,row) list
  return sol.map((r,c)=>`(${c+1},${r+1})`).join(' ');
}
function sectionAnswer(N, sols, idx, nodes){
  if(sols.length===0){
    return `⛔ No solution exists for N=${N}.`;
  }
  const s = sols[idx];
  const coords = toCoords(s);
  const vec = s.map(x=>x+1).join(', ');
  return [
    `✅ Found ${sols.length} solution(s) for N=${N}.`,
    `Showing solution ${idx+1} of ${sols.length}:`,
    ``,
    `Positions (col,row, 1-based):`,
    ` ${coords}`,
    `Vector (row per column): [${vec}]`,
    `Backtracking nodes explored: ${nodes}`
  ].join('\n');
}
function sectionReason(N){
  return [
    `Constraints:`,
    ` • Exactly one queen per column (and implicitly per row).`,
    ` • No two queens share a diagonal: for any two queens (r1,c1),(r2,c2), we must have r1−c1 ≠ r2−c2 and r1+c1 ≠ r2+c2.`,
    ``,
    `Search strategy:`,
    ` • Depth-first backtracking placing one queen per column with diagonal pruning.`,
    ` • Solutions are enumerated in lexicographic order by columns.`
  ].join('\n');
}
function sectionCheck(N, sols){
  const lines = [];
  // validate all solutions
  let okAll = true;
  for(const s of sols){
    const seen = new Set();
    for(let c=0;c<s.length;c++){
      const r = s[c];
      const keyC = 'C'+r, keyD1 = 'D1'+(r-c), keyD2 = 'D2'+(r+c);
      if(seen.has(keyC) || seen.has(keyD1) || seen.has(keyD2)){ okAll=false; break; }
      seen.add(keyC); seen.add(keyD1); seen.add(keyD2);
    }
    if(!okAll) break;
  }
  lines.push(`• All ${sols.length} solution(s) satisfy row/column/diagonal constraints. ${okAll?'✓':'✗'}`);
  if(N in KNOWN){
    const match = (sols.length===KNOWN[N]);
    lines.push(`• Count matches known reference for N=${N}: ${sols.length} (expected ${KNOWN[N]}). ${match?'✓':'✗'}`);
  }
  return lines.join('\n');
}

function buildARC(N, sols, idx, nodes){
  let txt = '';
  txt += "============================================\n";
  txt += "n-Queens — Answer / Reason why / Check (harness)\n";
  txt += "============================================\n\n";
  txt += `Board size : N = ${N}\n`;
  txt += "Goal       : Place N queens so none attack each other\n\n";

  txt += "Answer\n======\n";
  txt += sectionAnswer(N, sols, idx, nodes) + "\n\n";

  txt += "Reason why\n==========\n";
  txt += sectionReason(N) + "\n\n";

  txt += "Check (harness)\n===============\n";
  txt += sectionCheck(N, sols) + "\n";

  return txt;
}

// ---------- ARC UI helpers ----------
function toggleArcStyle(){
  const pre = document.getElementById('arc');
  const cards = document.getElementById('arc-cards');
  const btn = document.getElementById('styleBtn');
  const showingCards = cards.style.display !== 'none';
  if(showingCards){
    cards.style.display = 'none';
    pre.style.display = 'block';
    btn.textContent = 'Style: Plain';
  }else{
    cards.style.display = 'block';
    pre.style.display = 'none';
    btn.textContent = 'Style: Cards';
  }
}
function updateArcCards(){
  const txt = document.getElementById('arc').textContent || "";
  const answer  = (txt.match(/^\s*Answer\s*\n=+\n([\s\S]*?)\n(?=Reason why\s*\n=+)/m) || [,""])[1].trim();
  const reason  = (txt.match(/^\s*Reason why\s*\n=+\n([\s\S]*?)\n(?=Check\s+\(harness\)\s*\n=+)/m) || [,""])[1].trim();
  const check   = (txt.match(/^\s*Check\s+\(harness\)\s*\n=+\n([\s\S]*)$/m) || [,""])[1].trim();
  document.getElementById('arc_ans').textContent    = answer || '(no run yet)';
  document.getElementById('arc_reason').textContent = reason || '(no run yet)';
  document.getElementById('arc_check').textContent  = check  || '(no run yet)';
}
function copyOutput(){ const el=document.getElementById('arc'); const r=document.createRange(); r.selectNodeContents(el); const s=window.getSelection(); s.removeAllRanges(); s.addRange(r); document.execCommand('copy'); s.removeAllRanges(); }
function downloadARC(){ const blob=new Blob([document.getElementById('arc').textContent],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='n_queens_output.txt'; document.body.appendChild(a); a.click(); a.remove(); }

// ---------- Global state & runners ----------
let G = { N: 8, sols: [], nodes: 0, idx: 0 };

function run(){
  const N = Math.max(1, Math.min(16, parseInt(document.getElementById('nInput').value, 10) || 8));
  const {solutions, nodes} = solveNQueens(N);
  G = {N, sols: solutions, nodes, idx: 0};
  document.getElementById('statusPill').textContent = `N=${N} • ${solutions.length} solution(s)`;
  document.getElementById('casebox').textContent = `Board size : N = ${N}\nGoal       : Place N queens so none attack each other`;
  updateBoardAndARC();
}
function nextSol(){
  if(!G.sols.length) return;
  G.idx = (G.idx + 1) % G.sols.length;
  updateBoardAndARC();
}
function prevSol(){
  if(!G.sols.length) return;
  G.idx = (G.idx - 1 + G.sols.length) % G.sols.length;
  updateBoardAndARC();
}
function updateBoardAndARC(){
  const total = G.sols.length;
  const idx = Math.min(G.idx, Math.max(0, total-1));
  const shown = total ? idx+1 : 0;
  document.getElementById('solBadge').textContent = total ? `Showing ${shown} / ${total}` : '—';
  renderBoard(G.N, total ? G.sols[idx] : null);
  document.getElementById('boardMeta').textContent = total ? `Solution ${shown} of ${total}` : '(no solution shown)';
  const arc = buildARC(G.N, G.sols, idx, G.nodes);
  document.getElementById('arc').textContent = arc;
  updateArcCards();
}

// Bootstrap
run();
</script>
</body>
</html>
