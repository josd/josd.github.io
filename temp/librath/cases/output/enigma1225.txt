Answer
------
Size: 8
Permutation (1-based): [2, 1, 4, 3, 6, 5, 8, 7]
Max total: 544
Board (class IDs, first-occurrence order):
   1  1  2  3  4  5  6  7
   1  1  3  2  5  4  7  6
   3  2  8  8  9 10 11 12
   2  3  8  8 10  9 12 11
   5  4 10  9 13 13 14 15
   4  5  9 10 13 13 15 14
   7  6 12 11 15 14 16 16
   6  7 11 12 14 15 16 16

Reason why
----------
We constrain M = transpose(list_permute(P, M)) and require distinct rows.
Cells merge into equivalence classes (same symbol).
Total computed as: sort frequencies ascending, then sum (rank * freq).
Frequencies (ascending): [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]
Total = 1*4 + 2*4 + 3*4 + 4*4 + 5*4 + 6*4 + 7*4 + 8*4 + 9*4 + 10*4 + 11*4 + 12*4 + 13*4 + 14*4 + 15*4 + 16*4 = 544

Check (harness)
---------------
OK: constraints hold and the total is maximal for N = 8
