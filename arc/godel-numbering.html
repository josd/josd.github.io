<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gödel Numbering</title>
  <style>
    :root{
      --bg:#f8fafc; --panel:#fff; --ink:#0f172a; --muted:#475569; --accent:#2563eb; --border:#e2e8f0; --good:#16a34a; --bad:#dc2626;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial;
    }
    html, body { background:var(--bg); color:var(--ink); font-family:var(--sans); line-height:1.6; }
    .wrap { max-width: 980px; margin: 2rem auto; padding: 0 1rem 4rem; }
    h1 { font-size: clamp(1.8rem,2.2vw+1rem,2.6rem); margin:0 0 .5rem; }
    h2 { font-size:1.25rem; margin-top:2rem; border-top:1px solid var(--border); padding-top:1rem; }
    h3 { font-size:1.05rem; margin:1rem 0 .5rem; color:var(--muted); }
    p { margin:.25rem 0 .75rem; }
    .panel { background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:1rem; box-shadow:0 1px 2px rgba(2,6,23,.05); }
    .grid { display:grid; grid-template-columns:1fr; gap:1rem; }
    textarea, input[type="text"] { width:100%; padding:.75rem .8rem; background:#fff; border:1px solid var(--border); border-radius:10px; font-family:var(--mono); font-size:.95rem; }
    textarea { min-height:3.5rem; resize:vertical; }
    .row { display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; }
    button { appearance:none; border:1px solid var(--border); background:#fff; color:var(--ink); padding:.6rem .9rem; border-radius:10px; cursor:pointer; font-weight:600; }
    button.primary { background:var(--accent); color:#fff; border-color:var(--accent); }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .answer { font-family:var(--mono); word-break: break-all; overflow-wrap:anywhere; white-space:pre-wrap; }
    table { width:100%; border-collapse:collapse; font-variant-numeric:tabular-nums; }
    th, td { border-bottom:1px solid var(--border); padding:.4rem .5rem; text-align:left; }
    tbody tr:hover { background:#f1f5f9; }
    .muted{color:var(--muted);} .badge{display:inline-block;padding:.15rem .4rem;border-radius:.5rem;border:1px solid var(--border);background:#fff;font-family:var(--mono);font-size:.85em}
    .ok{color:var(--good);font-weight:700} .fail{color:var(--bad);font-weight:700}
    .foot{margin-top:.5rem;color:var(--muted);font-size:.9rem}
    .warn{background:#fff7ed;border-color:#fed7aa}
  </style>
</head>
<body>
  <main class="wrap">
    <header style="margin-bottom:1rem">
      <h1>Gödel Numbering</h1>
    </header>

    <section class="panel">
      <h2>What this page does</h2>
      <p>Implements Gödel numbering entirely in <strong>Python</strong> (big integers, primes, encoding/decoding). Runs in your browser using the <em>Pyodide</em> runtime (WebAssembly build of CPython). UI remains plain HTML; Python manipulates the DOM via the <code>js</code> bridge.</p>
      <p class="muted">ASCII synonyms supported: <code>! → ¬</code>, <code>&amp; → ∧</code>, <code>| → ∨</code>, <code>-&gt; → →</code>, <code>&lt;-&gt; → ↔</code>. Spaces are ignored.</p>
    </section>

    <section class="panel">
      <h2>Prompt &amp; Question</h2>
      <p><strong>Teach</strong> the program a Gödel encoding scheme and answer:</p>
      <p><strong>Question.</strong> Compute the Gödel number ⟦ϕ⟧ for a given formula ϕ; also provide a “Reason Why” and run “Check” tests.</p>
    </section>

    <section class="panel">
      <h2>Data (Alphabet &amp; Codes)</h2>
      <div class="grid">
        <div>
          <h3>Reserved symbols</h3>
          <table id="reservedTable"><thead><tr><th>Symbol</th><th>Code c(·)</th></tr></thead><tbody></tbody></table>
        </div>
        <div>
          <h3>Generic rule</h3>
          <p>For any character <code>χ</code> not listed, use <code>c(χ)=1000+codePoint(χ)</code>. Then <code>E(χ)=c(χ)+1</code>.</p>
        </div>
      </div>
    </section>

    <section class="panel" id="logic">
      <h2>Logic (Gödel Numbering)</h2>
      <ol>
        <li>Primes: <code>p₁=2, p₂=3, …</code></li>
        <li>Tokenize ϕ (normalize ASCII to logic symbols; strip spaces).</li>
        <li>Define <code>⟦ϕ⟧ = ∏ pᵢ^{c(σᵢ)+1}</code>.</li>
        <li>Decode by dividing successively by <code>p₁, p₂, …</code> and reading exponents; then subtract 1 and invert <code>c</code>.</li>
      </ol>
    </section>

    <section class="panel" id="program">
      <h2>Program</h2>
      <h3>Encode a formula</h3>
      <textarea id="formula">(∀x) (P(x) → Q(x))</textarea>
      <div class="row" style="margin-top:.5rem">
        <button class="primary" id="btnEncode">Compute ⟦ϕ⟧</button>
        <button id="btnDecode">Decode ⟦ϕ⟧</button>
        <button id="btnCopy">Copy number</button>
      </div>
      <h3 style="margin-top:1rem">Answer</h3>
      <div id="answer" class="answer panel" style="margin-top:.25rem"></div>
      <p class="foot">Rendered as a decimal string (limit increased for very large numbers).</p>
      <div id="runtimeWarn" class="panel warn" style="display:none; margin-top:.75rem"></div>
    </section>

    <section class="panel" id="reason">
      <h2>Reason Why (mathematical English)</h2>
      <p>Let ϕ have token sequence σ₁…σₙ. Define <code>⟦ϕ⟧ := ∏ pᵢ^{E(σᵢ)}</code> with <code>E(σ)=c(σ)+1</code> and injective <code>c</code>. By the Fundamental Theorem of Arithmetic, prime factorization is unique. Therefore exponents <code>E(σᵢ)</code> are uniquely determined by ⟦ϕ⟧; subtracting 1 yields <code>c(σᵢ)</code>, from which σᵢ are uniquely recovered. Hence the encoding is injective and decoding is well-defined.</p>
    </section>

    <section class="panel" id="example">
      <h2>Prime Exponent Decomposition</h2>
      <p class="muted">The table lists <em>i</em>, <code>pᵢ</code>, exponent <code>eᵢ</code>, recovered symbol, and <code>c(·)=eᵢ-1</code> for the last operation.</p>
      <table id="decomp"><thead><tr><th>#</th><th>Prime pᵢ</th><th>Exponent eᵢ</th><th>Recovered symbol</th><th>c(·)</th></tr></thead><tbody></tbody></table>
    </section>

    <section class="panel" id="checks">
      <h2>Check (harness)</h2>
      <div id="checkList"></div>
    </section>
  </main>

  <!-- Python code (runs in Pyodide) -->
  <script type="text/python" id="pycode">
from js import document, navigator
from pyodide.ffi import create_proxy
import sys

# Allow very large integer→string conversions (CPython 3.11+ safety limit)
try:
    sys.set_int_max_str_digits(1_000_000)
except Exception:
    pass

RESERVED = {
  '¬': 1, '∧': 2, '∨': 3, '→': 4, '↔': 5,
  '∀': 6, '∃': 7, '(': 8, ')': 9,
  ',': 10, '=': 11, '⊥': 12, '⊤': 13
}
INV = {v:k for k,v in RESERVED.items()}

# ----- Utilities -----
def normalize(s: str) -> str:
    s = s.replace('<->','↔').replace('->','→').replace('!','¬').replace('&','∧').replace('|','∨')
    return ''.join(ch for ch in s if not ch.isspace())

def code_of(ch: str) -> int:
    return RESERVED[ch] if ch in RESERVED else 1000 + ord(ch)

def symbol_of(code: int) -> str:
    if code in INV: return INV[code]
    if code >= 1000:
        try: return chr(code-1000)
        except: return '�'
    return '?'

def first_primes(n: int) -> list[int]:
    primes, cand = [], 2
    while len(primes) < n:
        isprime = True
        for p in primes:
            if p*p > cand: break
            if cand % p == 0: isprime = False; break
        if isprime: primes.append(cand)
        cand += 1
    return primes

# ----- Core -----
def encode(formula: str):
    norm = normalize(formula)
    syms = list(norm)
    primes = first_primes(len(syms))
    rows = []
    N = 1
    for i, sym in enumerate(syms):
        c = code_of(sym); e = c + 1; p = primes[i]
        N *= pow(p, e)
        rows.append({'i':i+1,'p':p,'e':e,'sym':sym,'c':c})
    return N, rows, norm

def next_prime(n: int) -> int:
    if n < 2: return 2
    m = n + 1
    if m % 2 == 0 and m > 2: m += 1
    while True:
        if m == 2: return 2
        if m % 2 == 0: m += 1; continue
        d, ok = 3, True
        while d*d <= m:
            if m % d == 0: ok = False; break
            d += 2
        if ok: return m
        m += 2

def decode(num_str: str):
    s = num_str.strip()
    if not s.isdigit():
        raise ValueError('Input is not a valid positive integer')
    N = int(s)
    if N <= 0:
        raise ValueError('Gödel number must be positive')
    rows, i, p = [], 0, 2
    while N > 1:
        e = 0
        while N % p == 0:
            N //= p
            e += 1
        if e == 0:
            raise ValueError(f'Invalid Gödel number: missing factor p_{i+1}={p}')
        c = e - 1; sym = symbol_of(c)
        rows.append({'i':i+1,'p':p,'e':e,'sym':sym,'c':c})
        i += 1; p = next_prime(p)
    norm = ''.join(r['sym'] for r in rows)
    return rows, norm

# ----- Render helpers -----
def render_reserved():
    tbody = document.querySelector('#reservedTable tbody'); tbody.innerHTML = ''
    for sym, code in sorted(RESERVED.items(), key=lambda kv: kv[1]):
        tr = document.createElement('tr')
        tr.innerHTML = f"<td style='font-family:var(--mono)'>{sym}</td><td>{code}</td>"
        tbody.appendChild(tr)

def render_answer(text: str):
    document.getElementById('answer').textContent = text

def render_decomp(rows):
    tbody = document.querySelector('#decomp tbody'); tbody.innerHTML = ''
    for r in rows:
        tr = document.createElement('tr')
        tr.innerHTML = (
            f"<td>{r['i']}</td><td>{r['p']}</td><td>{r['e']}</td>"
            f"<td style='font-family:var(--mono)'>{r['sym']}</td><td>{r['c']}</td>"
        )
        tbody.appendChild(tr)

# ----- Actions -----
def compute_encode(event=None):
    try:
        formula = document.getElementById('formula').value
        N, rows, _ = encode(formula)
        render_answer(str(N))          # big int → string (limit raised above)
        render_decomp(rows)
    except Exception as e:
        render_answer(''); render_decomp([])
        __import__('js').window.alert(str(e))

def compute_decode(event=None):
    try:
        inp = document.getElementById('formula').value
        rows, norm = decode(inp)
        document.getElementById('formula').value = norm
        render_answer(inp.strip())
        render_decomp(rows)
    except Exception as e:
        __import__('js').window.alert(str(e))

async def on_copy(event=None):
    txt = document.getElementById('answer').textContent or ''
    if not txt: return
    try:
        await navigator.clipboard.writeText(txt)
        btn = document.getElementById('btnCopy'); btn.textContent = 'Copied!'
        __import__('js').window.setTimeout(create_proxy(lambda: setattr(btn,'textContent','Copy number')), 1200)
    except Exception:
        pass

# ----- Checks -----
def add_check(name, fn):
    try: ok = bool(fn())
    except Exception: ok = False
    div = document.createElement('div'); div.className = 'panel'; div.style.marginTop = '.5rem'
    div.innerHTML = f"<strong>{name}:</strong> <span class={'ok' if ok else 'fail'}>{'PASS' if ok else 'FAIL'}</span>"
    document.getElementById('checkList').appendChild(div)
    return ok

# Bootstrap
render_reserved()
document.getElementById('btnEncode').addEventListener('click', create_proxy(compute_encode))
document.getElementById('btnDecode').addEventListener('click', create_proxy(compute_decode))
document.getElementById('btnCopy').addEventListener('click', create_proxy(on_copy))

# Run once
compute_encode()

# Tests
def check_roundtrip():
    s = '(∀x)(P(x)→Q(x))'
    N, _, _ = encode(s)
    _, back = decode(str(N))      # relies on raised digit limit
    return back == normalize(s)

add_check('Round-trip encode→decode equals identity', check_roundtrip)
add_check('ASCII synonyms normalize correctly', lambda: encode('P(x) -> Q(x)')[0] == encode('P(x) → Q(x)')[0])
add_check('Different symbols map to different numbers', lambda: encode('P')[0] != encode('Q')[0])

def check_invalid():
    try:
        decode('3')
        return False
    except Exception:
        return True

add_check('Invalid decode complains', check_invalid)
  </script>

  <!-- Loader: Pyodide from CDN. For truly offline single-file, inline pyodide.js/pyodide.wasm as data URIs. -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
  <script>
    const warn = document.getElementById('runtimeWarn');
    async function main(){
      try {
        const pyodide = await loadPyodide({});
        await pyodide.runPythonAsync(document.getElementById('pycode').textContent);
      } catch (e) {
        warn.style.display = 'block';
        warn.textContent = 'Failed to initialize the Python runtime (Pyodide). For offline use, inline the runtime as data URIs.';
        console.error(e);
      }
    }
    main();
  </script>
</body>
</html>

