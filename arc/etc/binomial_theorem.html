<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sum of All Binomial Coefficients</title>
  <style>
    :root{
      --bg:#f7f9fc; --card:#ffffff; --text:#0f172a; --muted:#475569; --accent:#2563eb;
      --good:#16a34a; --bad:#dc2626; --border:#e2e8f0; --chip:#eef2ff; --code:#111827;
    }
    html, body { background: var(--bg); color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; }
    * { box-sizing: border-box; }
    .container{ max-width: 960px; margin: 24px auto; padding: 0 16px; }
    header{ display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
    h1{ font-size: 1.8rem; margin: 0; letter-spacing: -0.02em; }
    .subtitle{ color: var(--muted); }
    .card{ background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; box-shadow: 0 6px 20px rgba(2,6,23,0.05); }
    .stack{ display: flex; flex-direction: column; gap: 16px; }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:4px 10px; background:var(--chip); color:#1e3a8a; border-radius:999px; font-size:12px; font-weight:600; border:1px solid #c7d2fe; }
    .row{ display:flex; gap:12px; align-items:center; }
    input[type="number"]{ width: 160px; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #fbfdff; }
    button{ appearance:none; border:none; background:var(--accent); color:white; padding:10px 14px; border-radius: 12px; font-weight:700; cursor:pointer; box-shadow: 0 4px 14px rgba(37,99,235,.25); }
    button.secondary{ background:#0ea5e9; }
    button.ghost{ background:transparent; color:var(--accent); border:1px solid var(--accent); }
    button:disabled{ opacity:.6; cursor:not-allowed; }
    .grid{ display:grid; grid-template-columns: 1fr; gap: 16px; }
    .muted{ color: var(--muted); }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color: var(--code); word-break: break-word; overflow-wrap: anywhere; white-space: normal; }
    .kpi{ display:flex; gap: 16px; flex-wrap: wrap; }
    .kpi .card{ padding: 12px 14px; }
    .k{ font-weight:700; }
    .v{ font-variant-numeric: tabular-nums; }
    .list{ display:flex; flex-direction: column; gap: 12px; }
    .term{ padding:10px; background:#f8fafc; border:1px dashed var(--border); border-radius:12px; }
    details{ border:1px solid var(--border); border-radius: 12px; padding: 10px 12px; background:#fafcff; }
    details summary{ cursor: pointer; font-weight:700; color:#0b3eaa; }
    .badge{ padding:2px 8px; border-radius:999px; font-weight:700; font-size:12px; border:1px solid #cbd5e1; background:#f1f5f9; color:#0f172a; }
    .ok{ background:#dcfce7; color:#166534; border:1px solid #86efac; }
    .fail{ background:#fee2e2; color:#991b1b; border:1px solid #fecaca; }
    .harness{ border-left: 6px solid #c7d2fe; }
    .h-title{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .small{ font-size: 12px; }
    code{ background:#f1f5f9; padding:2px 6px; border-radius:6px; }
    footer{ color: var(--muted); font-size: 12px; text-align:center; margin: 16px 0 40px; }
    .divider{ height:1px; background: var(--border); margin: -4px 0 8px; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; }
  .chips .badge{ word-break: break-all; overflow-wrap: anywhere; white-space: normal; }
.kpi .card .v{ word-break: break-word; overflow-wrap: anywhere; }
.row{ min-width: 0; }
</style>
</head>
<body>
  <div class="container stack">
    <header class="card stack">
      <div class="row" style="justify-content:space-between; align-items:flex-start; width:100%">
        <div>
          <h1>Sum of all binomial coefficients</h1>
        </div>
      </div>
      <span class="badge">Problem: B(n) = Σₖ₌₀ⁿ C(n,k)</span>
      <p class="muted">Give a non‑negative integer <em>n</em>. This page states the closed form of <span class="mono">B(n)</span>, explains why it is true in mathematical English, and verifies it with a built‑in test harness.</p>
    </header>

    <!-- INPUT -->
    <section class="card stack" id="input-card">
      <h2 style="margin:0">Input</h2>
      <div class="divider"></div>
      <div class="row">
        <label class="mono">n = </label>
        <input id="nInput" type="number" min="0" step="1" value="4000" />
        <button type="button" id="solve">Evaluate B(n)</button>
        <button type="button" id="clear">Clear</button>
      </div>
      <p class="small muted">Constraints: n ∈ ℕ, typically n ≤ 1000 for display. All arithmetic uses exact <code>BigInt</code>.</p>
    </section>

    <!-- OUTPUT -->
    <section class="card stack" id="output-card" aria-live="polite">
      <h2 style="margin:0">Output</h2>
      <div class="divider"></div>

      <!-- Answer KPIs -->
      <section class="stack">
        <div class="kpi">
          <div class="card">
            <div class="k">Answer</div>
            <div id="answer" class="v mono">—</div>
          </div>
          <div class="card">
            <div class="k">Closed form</div>
            <div id="closed" class="v mono">B(n) = 2^n</div>
          </div>
          <div class="card">
            <div class="k">Σ C(n,k)</div>
            <div id="sumRow" class="v mono">—</div>
          </div>
          <div class="card">
            <div class="k">Row length</div>
            <div id="rowLen" class="v mono">—</div>
          </div>
        </div>
      </section>

      <!-- Reason Why (mathematical English) -->
      <section class="stack">
        <h3 style="margin:0">Reason Why</h3>
        <div class="list">
          <div class="term">
            <strong>Algebraic.</strong> The binomial theorem states 
            <span class="mono">(x + y)^n = Σₖ C(n,k) x^{n−k} y^k</span>. Substituting <span class="mono">x = y = 1</span> gives 
            <span class="mono">2^n = Σₖ C(n,k)</span>. Hence <span class="mono">B(n) = 2^n</span>.
          </div>
          <div class="term">
            <strong>Combinatorial.</strong> Each term <span class="mono">C(n,k)</span> counts the <span class="mono">k</span>‑element subsets of an <span class="mono">n</span>‑set. Summing over all <span class="mono">k</span> counts every subset exactly once, so the total is the number of all subsets, namely 
            <span class="mono">2^n</span>.
          </div>
          <div class="term">
            <strong>Symmetry check.</strong> Because <span class="mono">C(n,k) = C(n,n−k)</span>, the partial sums are pairwise matched; the extremes satisfy <span class="mono">C(n,0)=C(n,n)=1</span>.
          </div>
        </div>
        <details>
          <summary>Show coefficients C(n,k)</summary>
          <div id="row" class="chips mono"></div>
        </details>
      </section>

      <!-- Check (harness) for the user's n -->
      <section class="stack">
        <h3 style="margin:0">Check (harness)</h3>
        <div id="checks" class="list"></div>
      </section>
    </section>

    <!-- PRELOADED HARNESS CASES (≥ 6) -->
    <section class="card stack harness" id="preloaded">
      <div class="h-title">
        <h2 style="margin:0">Preloaded Checks (harness)</h2>
        <div class="row">
          <button id="runAll">Run all</button>
          <button class="ghost" id="clearHarness">Clear results</button>
        </div>
      </div>
      <p class="small muted">Each block recomputes <span class="mono">B(n)</span> two ways (<span class="mono">Σ C(n,k)</span> vs <span class="mono">2^n</span>) and asserts they agree. One case is intentionally invalid.</p>
      <div id="harnesses" class="stack"></div>
    </section>

    <footer>
      <div>Built as a self‑checking artifact: program → <em>Answer</em>, <em>Reason Why</em>, <em>Check</em>.</div>
      <div class="small">This page performs only on‑device computation.</div>
    </footer>
  </div>

<script>
  // ---------- BigInt helpers ----------
  const ZERO = 0n, ONE = 1n, TWO = 2n;
  const toBig = (x) => { try { return BigInt(x); } catch { return null; } };
  const isNonNegInt = (b) => b !== null && b >= 0n;

  // fast power: a^e for BigInt
  function pow(a, e){
    let base = a, exp = e, res = 1n;
    while (exp > 0n){ if (exp & 1n) res *= base; base *= base; exp >>= 1n; }
    return res;
  }

  // compute the nth binomial row [C(n,0),...,C(n,n)] as BigInts
  function binomRow(n){
    const N = Number(n);
    const row = new Array(N+1);
    row[0] = 1n;
    for (let k = 1; k <= N; k++){
      // C(n,k) = C(n,k-1) * (n-k+1)/k
      const prev = row[k-1];
      const num = n - BigInt(k) + 1n; // BigInt
      const den = BigInt(k);
      row[k] = (prev * num) / den; // exact division for binomial coefficients
    }
    return row;
  }

  function sumRow(row){ return row.reduce((acc,v) => acc + v, 0n); }

  // ---------- UI helpers ----------
  const el = (tag, attrs = {}, children = []) => {
    const node = document.createElement(tag);
    Object.entries(attrs).forEach(([k,v]) => {
      if (k === 'class') node.className = v; else if (k === 'html') node.innerHTML = v; else if (k.startsWith('on')) node.addEventListener(k.slice(2).toLowerCase(), v); else node.setAttribute(k, v);
    });
    children.forEach(c => node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c));
    return node;
  };

  function renderChips(div, row){
    div.replaceChildren(...row.map((v,k) => el('span', { class:'badge' }, [`C(n,${k})=${v.toString()}`])));
  }

  function renderChecks(n, row, sum, pow2){
    const checks = document.getElementById('checks');
    const list = [];

    const eq = sum === pow2;
    list.push(el('div', { class:'row' }, [ el('span', { class:'badge ' + (eq ? 'ok' : 'fail') }, [ eq ? 'PASS' : 'FAIL' ]), document.createTextNode(' Equality '), el('span', { class:'mono' }, ['Σ C(n,k) = 2^n']) ]));

    const ends = row.length >= 1 && row[0] === 1n && row[row.length-1] === 1n;
    list.push(el('div', { class:'row' }, [ el('span', { class:'badge ' + (ends ? 'ok' : 'fail') }, [ ends ? 'PASS' : 'FAIL' ]), el('span', { class:'mono' }, ['C(n,0)=C(n,n)=1']) ]));

    const sym = row.every((v,i) => v === row[row.length-1-i]);
    list.push(el('div', { class:'row' }, [ el('span', { class:'badge ' + (sym ? 'ok' : 'fail') }, [ sym ? 'PASS' : 'FAIL' ]), el('span', { class:'mono' }, ['Symmetry C(n,k)=C(n,n−k)']) ]));

    const lenOk = row.length === Number(n) + 1;
    list.push(el('div', { class:'row' }, [ el('span', { class:'badge ' + (lenOk ? 'ok' : 'fail') }, [ lenOk ? 'PASS' : 'FAIL' ]), el('span', { class:'mono' }, ['Row length n+1']) ]));

    // middle (when n even)
    if ((n % 2n) === 0n){
      const mid = row[Number(n/2n)];
      const midOk = typeof mid !== 'undefined' && mid >= 1n;
      list.push(el('div', { class:'row' }, [ el('span', { class:'badge ' + (midOk ? 'ok' : 'fail') }, [ midOk ? 'PASS' : 'FAIL' ]), el('span', { class:'mono' }, ['Central coefficient ≥ 1']) ]));
    }

    // Pascal identity spot-check (random k)
    if (row.length > 2){
      const k = Math.min(2, row.length-2);
      const lhs = row[k];
      const rhs = row[k-1] + row[k+1] * 0n + (row[k-1] + row[k]) - row[k-1]; // keep code simple, see below
    }

    list.push(el('div', { class:'row' }, [ el('span', { class:'badge ok' }, ['FACT']), el('span', { class:'small muted' }, ['Any subset of an n‑set corresponds to a unique 0/1 choice per element ⇒ 2^n subsets.']) ]));

    checks.replaceChildren(...list);
  }

  function evaluate(){
    const nVal = toBig(document.getElementById('nInput').value.trim());
    if (!isNonNegInt(nVal)){
      document.getElementById('answer').textContent = '—';
      document.getElementById('sumRow').textContent = '—';
      document.getElementById('rowLen').textContent = '—';
      document.getElementById('row').replaceChildren();
      document.getElementById('checks').replaceChildren(el('div', { class:'term' }, [ el('span', { class:'badge fail' }, ['FAIL']), document.createTextNode(' n must be a non‑negative integer.') ]));
      return;
    }
    const n = nVal;
    const row = binomRow(n);
    const S = sumRow(row);
    const P = pow(2n, n);

    document.getElementById('answer').textContent = `B(${n}) = ${P.toString()}`;
    document.getElementById('sumRow').textContent = S.toString();
    document.getElementById('rowLen').textContent = `${row.length}`;
    renderChips(document.getElementById('row'), row);
    renderChecks(n, row, S, P);
  }

  document.getElementById('solve').onclick = evaluate;
  document.getElementById('clear').onclick = () => {
    document.getElementById('nInput').value = '';
    document.getElementById('answer').textContent = '—';
    document.getElementById('sumRow').textContent = '—';
    document.getElementById('rowLen').textContent = '—';
    document.getElementById('row').replaceChildren();
    document.getElementById('checks').replaceChildren();
  };

  // ---------- Preloaded harnesses (≥ 8 including one invalid) ----------
  const harnessList = [
    { n: 0, title: 'n = 0 ⇒ [1] and B(0)=1' },
    { n: 1, title: 'n = 1 ⇒ [1,1] and B(1)=2' },
    { n: 2, title: 'n = 2 ⇒ [1,2,1] and B(2)=4' },
    { n: 3, title: 'n = 3 ⇒ [1,3,3,1] and B(3)=8' },
    { n: 5, title: 'n = 5 ⇒ B(5)=32' },
    { n: 10, title: 'n = 10 ⇒ B(10)=1024' },
    { n: 20, title: 'n = 20 ⇒ B(20)=1,048,576' },
    { n: -1, title: 'Invalid (should fail): n = -1', negative:true },
  ];

  const harnessDiv = document.getElementById('harnesses');

  function makeHarnessCard(h){
    const card = el('section', { class:'card stack' });
    const head = el('div', { class:'h-title' }, [ el('div', {}, [ el('strong',{},[h.title]) ]), el('div', { class:'small muted' }, ['Check (harness)']) ]);
    const kpis = el('div', { class:'kpi' });
    const ans = el('div', { class:'card' }); ans.append(el('div', { class:'k' }, ['Answer']), el('div', { class:'v mono' }, ['—']));
    const closed = el('div', { class:'card' }); closed.append(el('div', { class:'k' }, ['Closed form']), el('div', { class:'v mono' }, ['B(n)=2^n']));
    const sumK = el('div', { class:'card' }); sumK.append(el('div', { class:'k' }, ['Σ C(n,k)']), el('div', { class:'v mono' }, ['—']));
    const len = el('div', { class:'card' }); len.append(el('div', { class:'k' }, ['Row length']), el('div', { class:'v mono' }, ['—']));
    kpis.append(ans, closed, sumK, len);

    const reason = el('p', { class:'muted small' }, [
      'Because (1+1)^n = Σ C(n,k) by the binomial theorem, setting x=y=1 yields B(n)=2^n; combinatorially, it counts all subsets.'
    ]);
    const checks = el('div', { class:'list' });
    const run = el('button', { class:'secondary' }, ['Run']);

    run.onclick = () => {
      const nBig = toBig(h.n);
      if (!isNonNegInt(nBig)){
        ans.querySelector('.v').textContent = '—';
        sumK.querySelector('.v').textContent = '—';
        len.querySelector('.v').textContent = '—';
        checks.replaceChildren(el('div', { class:'term' }, [ el('span', { class:'badge fail' }, ['FAIL']), document.createTextNode(' n must be a non‑negative integer.') ]));
        return;
      }
      const row = binomRow(nBig);
      const S = sumRow(row);
      const P = pow(2n, nBig);
      ans.querySelector('.v').textContent = `B(${nBig}) = ${P}`;
      sumK.querySelector('.v').textContent = S.toString();
      len.querySelector('.v').textContent = `${row.length}`;

      const list = [];
      const eq = S === P;
      list.push(el('div', { class:'row' }, [ el('span', { class:'badge ' + (eq ? 'ok' : 'fail') }, [ eq ? 'PASS' : 'FAIL' ]), document.createTextNode(' Equality '), el('span', { class:'mono' }, ['Σ C(n,k) = 2^n']) ]));
      const ends = row.length >= 1 && row[0] === 1n && row[row.length-1] === 1n;
      list.push(el('div', { class:'row' }, [ el('span', { class:'badge ' + (ends ? 'ok' : 'fail') }, [ ends ? 'PASS' : 'FAIL' ]), el('span', { class:'mono' }, ['C(n,0)=C(n,n)=1']) ]));
      const sym = row.every((v,i) => v === row[row.length-1-i]);
      list.push(el('div', { class:'row' }, [ el('span', { class:'badge ' + (sym ? 'ok' : 'fail') }, [ sym ? 'PASS' : 'FAIL' ]), el('span', { class:'mono' }, ['Symmetry C(n,k)=C(n,n−k)']) ]));
      list.push(el('div', { class:'row' }, [ el('span', { class:'badge ok' }, ['FACT']), el('span', { class:'small muted' }, [`B(${nBig}) counts all 0/1 choices across ${nBig} elements.`]) ]));
      checks.replaceChildren(...list);
    };

    if (h.negative){
      const warn = el('div', { class:'small muted' }, ['This case is intentionally invalid and should report a failure.']);
      card.append(head, kpis, reason, warn, checks, run);
    } else {
      card.append(head, kpis, reason, checks, run);
    }
    return card;
  }

  harnessList.forEach(h => harnessDiv.appendChild(makeHarnessCard(h)));
  document.getElementById('runAll').onclick = () => {
    const buttons = [...harnessDiv.querySelectorAll('button.secondary')];
    buttons.forEach(b => b.click());
  };
  document.getElementById('clearHarness').onclick = () => {
    harnessDiv.querySelectorAll('.list').forEach(div => div.replaceChildren());
    harnessDiv.querySelectorAll('.v').forEach(div => div.textContent = '—');
  };

  // auto-evaluate initial n
  evaluate();
</script>
</body>
</html>

